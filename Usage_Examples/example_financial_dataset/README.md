# Example: Financial Dataset Generation

This example demonstrates how to generate a synthetic dataset of financial advisory conversations using WizardSData. It includes:
- A **Jupyter Notebook**: `example_retail_banking.ipynb`
- A **Configuration JSON**: `myconfiguration.json`
- A **Generated Dataset**: `test_financial_dataset01_5.json`
- Profile definitions and prompt templates used for dataset construction.

## **1. Configuration File (myconfiguration.json)**

This file defines parameters for dataset generation, including:

* Model selection (gpt-4o-mini for both client and advisor)
* Temperature and Top-P values to control randomness in responses
* Token limits for responses
* Path to profiles and prompt templates

### Configuration Values and Rationale
```json
{
    "temperature_client": 0.8,
    "top_p_client": 0.95,
    "frequency_penalty_client": 0.3,
    "max_tokens_client": 175,
    "max_recommended_questions": 15,
    "temperature_advisor": 0.1,
    "top_p_advisor": 0.9,
    "frequency_penalty_advisor": 0.1,
    "max_tokens_advisor": 325,
    "API_KEY": "YOUR-API-KEY",
    "template_client_prompt": "../../templates/financial01/prompts/financial_client_01.j2",
    "template_advisor_prompt": "../../templates/financial01/prompts/financial_advisor_01.j2",
    "file_output": "./test_financial_dataset01_5.json",
    "model_client": "gpt-4o-mini",
    "model_advisor": "gpt-4o-mini",
    "file_profiles": "../../templates/financial01/profiles/financial_sample01_5.json"
}
```
* **Temperature settings**: temperature_client is set to 0.8 to allow for more diverse client responses, simulating natural human variation in conversation. temperature_advisor is lower (0.1) to keep financial advice stable and precise.
* **Top-P values**: top_p_client is slightly higher (0.95) to encourage more variety, while top_p_advisor is 0.9 to maintain controlled generation with some variability.
* **Frequency penalties**: These values (0.3 for client, 0.1 for advisor) reduce repetitive responses, ensuring natural dialogue flow. As the advisor maybe must repeat some financial words the repetition penalty is lower. 
* **Token limits**: The client’s response is capped at 175 tokens to keep messages concise, while the advisor is allowed 325 tokens to provide detailed financial explanations.
* **Model choice**: gpt-4o-mini is used for both roles, balancing efficiency with quality.

File paths: Defines the source of profile data, prompt templates, and the output dataset.

## **2. Profiles (`financial_sample01_5.json`)**
This JSON file defines different financial personas, each with:

* Age, marital status, country, residence type: These attributes help shape the demographic and geographical context of each persona, ensuring diversity in financial scenarios.
* Profession and employment status: Defining a persona's career background provides insight into their financial stability, income sources, and potential financial concerns.
* Financial products they own: Specifies the financial instruments already in use, such as savings accounts, stocks, retirement funds, or real estate investments, to tailor conversations accordingly.
* Financial goal: Each persona has a specific financial objective, such as saving for a house deposit, planning for retirement, or securing long-term investments.
* Investment horizon: Indicates whether the persona is focused on short-term, medium-term, or long-term financial goals, influencing the recommendations given by the financial advisor.
* Risk tolerance: Determines how aggressively or conservatively a persona is willing to invest, which affects the type of financial strategies proposed in conversations.
* Financial knowledge level: Helps adjust the complexity of explanations and advice, ensuring that conversations are aligned with the persona’s understanding of financial concepts.

Example Profile:
```json
{
    "id": 1,
    "age": 30,
    "marital_status": "Single",
    "country": "Spain",
    "residence_area": "Urban",
    "profession": "Software Developer",
    "employment_status": "Employed",
    "financial_products": ["Savings account", "Tech stocks"],
    "financial_goal": "Save for house deposit",
    "investment_horizon": "Medium-term",
    "risk_tolerance": "Moderate",
    "financial_knowledge": "Intermediate"
}
```
This data is dynamically inserted into prompt templates.

## **3. Prompt Templates and Generated Prompts**
The prompts are generated by replacing placeholders in the template files with values from the profile dataset. Each profile contains attributes such as age, profession, financial goal, and risk tolerance, which are inserted into the corresponding template variables. This dynamic substitution process personalizes the conversation for each user, ensuring that the generated dialogues reflect realistic financial interactions tailored to individual backgrounds. For example, in financial_client_01.j2, placeholders like {{ profile.age }} are replaced with actual values such as 30, resulting in a customized prompt. 

**financial_client_01.j2 (Client Prompt Template Before Substitution)**
```j2
You are a {{ profile.age }}-year-old {{ profile.marital_status | lower }} client living in a {{ profile.residence_area | lower }} area of {{ profile.country }}.
You work as a {{ profile.profession | lower }} and have {{ profile.financial_knowledge | lower }} financial knowledge.
You currently have {{ profile.financial_products | join(' and ') }}.
Your main financial goal is to {{ profile.financial_goal | lower }} in the {{ profile.investment_horizon | lower }}.
You have a {{ profile.risk_tolerance | lower }} risk tolerance and are looking for advice on how to improve your saving and investment strategy.
```
**Generated Client Prompt Example**
```txt
You are a 30-year-old single client living in an urban area of Spain.
You work as a software developer and have intermediate financial knowledge.
You currently have a savings account and tech stocks.
Your main financial goal is to save for a house deposit in the medium term.
You have a moderate risk tolerance and are looking for advice on how to improve your saving and investment strategy.
```

**financial_advisor_01.j2 (Advisor Prompt Template Before Substitution)**
```j2
You are an expert financial advisor specializing in {{ profile.financial_goal | lower }}.

Client Context:
- The client is approximately {{ profile.age }} years old, {{ profile.marital_status | lower }}, and appears to be a {{ profile.profession | lower }} from {{ profile.country }}.
- The client's financial goal is to {{ profile.financial_goal | lower }}.

Instructions for the conversation:
- Start by greeting the client and asking relevant, natural questions to understand their financial situation, preferences, and concerns.
- Guide the conversation by asking about their current financial products, investment experience, and risk tolerance.
- Provide clear, concise, and professional advice tailored to the client's goal and profile as the information is revealed.
- Avoid using complex financial jargon unless necessary, and adapt your language to the client's knowledge level (you'll assess this through conversation).
- Focus on actionable recommendations to help the client achieve their goal.
- Keep the conversation realistic and friendly.
- End the conversation naturally once you believe the client's doubts have been resolved, or explicitly conclude by saying '[END]'
```
**Generated Advisor Prompt Example**
```text
You are an expert financial advisor specializing in saving for a house deposit.

Client Context:
- The client is approximately 30 years old, single, and appears to be a software developer from Spain.
- The client's financial goal is to save for a house deposit.

Instructions for the conversation:
- Start by greeting the client and asking relevant, natural questions to understand their financial situation, preferences, and concerns.
- Guide the conversation by asking about their current financial products, investment experience, and risk tolerance.
- Provide clear, concise, and professional advice tailored to the client's goal and profile as the information is revealed.
- Avoid using complex financial jargon unless necessary, and adapt your language to the client's knowledge level (you'll assess this through conversation).
- Focus on actionable recommendations to help the client achieve their goal.
- Keep the conversation realistic and friendly.
- End the conversation naturally once you believe the client's doubts have been resolved, or explicitly conclude by saying '[END]'
```
## **4. Generated Dataset (`test_financial_dataset01_5.json`)**
This file contains structured dialogues between a client and a financial advisor. Each conversation entry includes:
- `id_conversation`: Unique conversation ID
- `topic`: Financial topic discussed
- `sequence`: Order of exchange in the conversation
- `rol1`: Client's message
- `rol2`: Advisor's response

Example conversation:
```json
{
    "id_conversation": "b96f8a1f-1c66-4fc8-a74c-8ead4d71fd51",
    "topic": "Save for house deposit",
    "sequence": 0,
    "rol1": "Hi there! I’m looking for some advice on saving for a house deposit.",
    "rol2": "Hello! It's great to hear that you're looking to save for a house deposit. Could you tell me about your current financial situation?"
}
```

## **5. Notebook (`example_retail_banking.ipynb`)**
The Jupyter Notebook illustrates:
- Loading profile data
- Applying profile attributes to prompt templates
- Interacting with an LLM to generate responses
- Saving the final structured dataset

---

### **How This Example Works**
Profiles from financial_sample01_5.json are loaded, containing a diverse range of financial personas. These profiles provide structured attributes such as age, marital status, profession, financial goals, investment horizon, and risk tolerance. They serve as the foundation for tailoring realistic financial conversations.

Prompt templates (financial_client_01.j2 & financial_advisor_01.j2) use profile attributes dynamically to craft personalized dialogues. These templates guide both the client and advisor roles, ensuring a natural flow of conversation. The structure of these prompts allows for gradual information revelation, reflecting real-world financial advisory interactions.

The LLM generates responses based on structured prompts, integrating user-specific details from the profiles. The generation process accounts for different financial knowledge levels, ensuring that the advice provided is suitable for each persona. This approach enhances the model’s ability to simulate realistic financial consultations effectively.

A conversation dataset is created and saved in JSON format, capturing full interactions between clients and advisors. Each conversation includes structured message sequences, unique conversation identifiers, and specific financial topics. This dataset can be used for further analysis, training financial models, or evaluating LLM responses in financial advisory contexts.

---

## **Next Steps**
- Expand this example with different financial topics.
- Introduce alternative client personas with varying risk tolerance and investment strategies.
- Experiment with different LLMs to analyze their performance in financial advisory dialogues.

For questions or contributions, refer to the main WizardSData repository.

